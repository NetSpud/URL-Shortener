<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <title>URL Shortener!</title>
</head>

<body>

<div class="container">
        <h1>URL Shortener</h1>
        
        <p>Enter a url, and optionally a slug to create a shortened url!</p>

<form id='form'>
    <div class="form-group">
        <label for="url">URL</label>
        <input type="text" class="form-control" id="url" aria-describedby="URLHelp" placeholder="https://example.com" required>
        <small id="URLHelp" class="form-text text-muted">We'll never share your data with anyone else.</small>
    </div>
    <div class="form-group">
        <label for="slug">Slug</label>
        <input type="text" class="form-control" placeholder="myurlSlug" id="slug">
    </div>
    <!-- <div class="form-group form-check">
        <input type="checkbox" class="form-check-input" id="exampleCheck1">
        <label class="form-check-label" for="exampleCheck1">Check me out</label>
    </div> -->
    <button type="submit" class="btn btn-primary">Submit</button>
</form>
<p id='result'></p>

</div>


<div class="container" style="padding-top: 15rem;">
    <h1>Need to Delete a URL?</h1>
    
    <p>Want to delete a url? Just enter the secret token you got provided when you generated the url below, and then click the Submit button to delete it permanently.</p>

    <form id='delForm'>
        <div class="form-group">
            <label for="token">Token/Secret</label>
            <input type="text" class="form-control" id="token" aria-describedby="TokenHelp" placeholder="xxxxx xxxxx xxxxx xxxxx" required>
            <small id="TokenHelp" class="form-text text-muted">We'll never share your data with anyone else.</small>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
    <p id='delResult'></p>

</div>





    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>
<script>
    document.getElementById("form").addEventListener("submit", (e) => {
        e.preventDefault();
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                console.log(this.responseText);
                const data = JSON.parse(this.responseText);

                if(data.hasOwnProperty("err")) {
                    document.getElementById("result").innerHTML = data.err;

                } else {
                    document.getElementById("result").innerHTML = `
                    Output: <a href='localhost:3000/url/${data.slug}'>localhost:3000/url/${data.slug}</a><br>
                    Slug: ${data.slug}<br>
                    Url: ${data.url}<br> 
                    Secret (Used for deleting url): <b>${data.secret}</b> Save this if you need to remove your url - it's only shown once!`;

                }
                console.log(data);
            }
        };
        xhttp.open("POST", "/create", true);
        xhttp.setRequestHeader("Content-type", "application/json");
        xhttp.send(JSON.stringify({
            "url": document.getElementById("url").value,
            "slug": document.getElementById("slug").value
        }));
    });


document.getElementById("delForm").addEventListener("submit", (e) => {

    e.preventDefault();
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
            console.log(this.responseText);
            const data = JSON.parse(this.responseText);

            if (data.hasOwnProperty("err")) {
                document.getElementById("delResult").innerHTML = data.err;

            } else {
                document.getElementById("delResult").innerHTML = `
                  ${data.success}`;

            }
            console.log(data);
        }
    };
    xhttp.open("DELETE", "/delete", true);
    xhttp.setRequestHeader("Content-type", "application/json");
    xhttp.send(JSON.stringify({
        "token": document.getElementById("token").value,
    }));


});



</script>
  
</body>

</html>